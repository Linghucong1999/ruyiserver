"use strict";(self["webpackChunkruyiweb"]=self["webpackChunkruyiweb"]||[]).push([[444],{7824:function(e,s,a){a.r(s),a.d(s,{default:function(){return z}});var t=function(){var e=this,s=e._self._c;return s("div",{staticClass:"page-layout"},[s("div",{staticClass:"page-header-wrapper"},[s("PageHeader")],1),s("router-view",{staticClass:"sub-page"})],1)},o=[],i=function(){var e=this,s=e._self._c;return s("div",{staticClass:"components-page-header"},[s("div",{staticClass:"page-header-inner"},[s("div",{staticClass:"inline-block logo-wrapper"},[s("img",{staticClass:"cursor-pointer",attrs:{src:a(4316)},on:{click:e.goHome}}),e._t("left-slot")],2),s("div",{staticClass:"header-center-wrapper"},[e._t("default")],2),s("div",{staticClass:"user-wrapper"},[e._t("right-slot"),s("userHeaderBtn")],2)])])},r=[],l=function(){var e=this,s=e._self._c;return s("div",{staticClass:"user-head-btn-components"},[e.isLogined?s("el-dropdown",[s("div",{staticClass:"inline-block"},[s("div",{staticClass:"user-header-btn-img"},[s("img",{attrs:{src:e.userData.avatar||e.userHeadImage,alt:""}})]),s("div",{staticClass:"user-head-btn-name"},[e._v(e._s(e.userData.name))])]),e.isLogined?s("el-dropdown-menu",[s("el-dropdown-item",[s("user-info",{attrs:{"user-data":e.userData,"show-edit":!0},on:{"update:userData":function(s){e.userData=s},"update:user-data":function(s){e.userData=s},success:e.handleSuccesAvatar}},[s("i",{staticClass:"el-icon-user"}),e._v("个人中心 ")])],1),s("el-dropdown-item",[s("reset-password",[s("i",{staticClass:"el-icon-lock"}),e._v("修改密码 ")])],1),s("el-dropdown-item",[s("div",{on:{click:e.doLogout}},[s("i",{staticClass:"el-icon-switch-button"}),e._v("退出登录 ")])])],1):e._e()],1):s("div",{staticClass:"inline-block",on:{click:e.goLogin}},[e._v("登录/注册")])],1)},n=[],d=function(){var e=this,s=e._self._c;return s("div",{staticClass:"user-info-plane-dialog inline-block"},[s("div",{staticClass:"inline-block",on:{click:e.show}},[e._t("default")],2),e.dialogVisible?s("el-dialog",{staticClass:"page-dialog-warapper",attrs:{title:"个人中心",visible:e.dialogVisible,width:"500px","append-to-body":""},on:{"update:visible":function(s){e.dialogVisible=s},close:e.closeDialog}},[s("div",{staticClass:"user-info-plane"},[s("div",{staticClass:"user-image-wrapper"},[s("div",{staticClass:"user-image-inner"},[s("img",{attrs:{src:e.userData.avatar||e.userHeadImage}}),e.showEdit?s("div",{staticClass:"user-image-upload"},[s("el-tooltip",{attrs:{content:"点击头像更换 (只支持jpg、png、jpeg格式且大小不超过3M的图片)",placement:"top",effect:"dark"}},[s("el-upload",{staticClass:"user-image-upload-input",attrs:{accept:"image/jpeg,image/png,image/jpg",action:e.avaterurl,"before-upload":e.beforeUploadAvatar,"show-file-list":!1,limit:1,"on-remove":e.handleRemove,"on-exceed":e.handleExceed,headers:e.avatarToken,"on-success":e.handleAvatarSuccess,"on-preview":e.handlePictureCardPreview}},[s("i",{staticClass:"el-icon-upload"})])],1)],1):e._e()])]),s("el-form",{ref:"table",attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"昵称："}},[e.editName?s("div",{staticClass:"edit-name-wrapper"},[s("div",{staticClass:"edit-name-input"},[s("el-input",{attrs:{placeholder:e.userData.name},model:{value:e.name,callback:function(s){e.name=s},expression:"name"}})],1),s("el-button",{attrs:{size:"mini",icon:"el-icon-close",circle:""},on:{click:function(s){return e.setEditName(!1)}}}),s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-check",circle:""},on:{click:e.saveNickName}})],1):s("div",[s("span",{staticClass:"inline-block"},[e._v(e._s(e.userData.name))]),e.showEdit?s("el-button",{attrs:{size:"mini",icon:"el-icon-edit",type:"text",circle:""},on:{click:function(s){return e.setEditName(!0)}}}):e._e()],1)]),s("el-form-item",{attrs:{label:"用户名："}},[s("el-input",{attrs:{value:e.userData.username}})],1),s("el-form-item",{attrs:{label:"邮箱："}},[s("el-input",{attrs:{value:e.userData.email}})],1),s("el-form-item",{attrs:{label:"注册时间："}},[s("el-input",{attrs:{value:e._f("dateFormat")(e.userData.created)}})],1)],1)],1)]):e._e()],1)},c=[],u={props:{userData:{type:Object,default:()=>({})},showEdit:{type:Boolean,default:!1}},data(){return{dialogVisible:!1,userHeadImage:a(5976),uploadFilesImage:[],dialogImageUrl:"",editName:!1,name:""}},computed:{avaterurl(){return this.$config.baseURL+this.$api.updataUserAvatarURL},avatarToken(){return{Authorization:this.$store.getters.authorization}}},methods:{show(){this.dialogVisible=!0},closeDialog(){this.dialogVisible=!1,this.$emit("close")},beforeUploadAvatar(e){const s="image/jpeg"===e.type||"image/png"===e.type;if(!s)return this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),!1;const a=e.size/1024/1024<3;return!!a||(this.$message.error("上传头像图片大小不能超过 3MB!"),!1)},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},async handleAvatarSuccess(){this.$message.success("上传成功"),this.$emit("success")},handleRemove(){},handleExceed(e){this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${e.length} 个文件`)},setEditName(e){this.editName=!!e},saveNickName(){this.$api.updateUserNickname({name:this.name}).then((e=>{this.$store.commit("updateUserInfo",e.body),this.setEditName(!1)}))}}},p=u,m=a(2528),g=(0,m.c)(p,d,c,!1,null,"58dc9b40",null),h=g.exports,w=function(){var e=this,s=e._self._c;return s("div",{staticClass:"change-password inline-block"},[s("div",{staticClass:"inlie-block",on:{click:e.show}},[e._t("default")],2),e.dialogResetPassword?s("el-dialog",{staticClass:"page-dialog-wrapper",attrs:{title:"重置密码",width:"600px",visible:e.dialogResetPassword,"append-to-body":""},on:{"update:visible":function(s){e.dialogResetPassword=s},close:e.closeDialog}},[s("el-form",{ref:"formData",attrs:{model:e.form,rules:e.rules,"label-width":"120px","status-icon":""}},[s("el-form-item",{attrs:{label:"输入旧密码：",prop:"oldPassword"}},[s("el-input",{attrs:{placeholder:"请输入旧密码",type:"password","show-password":""},model:{value:e.form.oldPassword,callback:function(s){e.$set(e.form,"oldPassword",s)},expression:"form.oldPassword"}})],1),s("el-form-item",{attrs:{label:"新密码：",prop:"newPassword"}},[s("el-input",{attrs:{placeholder:"请输入新密码",type:"password",clearable:"","show-password":""},model:{value:e.form.newPassword,callback:function(s){e.$set(e.form,"newPassword",s)},expression:"form.newPassword"}})],1),s("el-form-item",{attrs:{label:"确认新密码：",prop:"reconPassword"}},[s("el-input",{attrs:{placeholder:"请再次输入新密码",type:"password",clearable:"","show-password":""},model:{value:e.form.reconPassword,callback:function(s){e.$set(e.form,"reconPassword",s)},expression:"form.reconPassword"}})],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{close:e.closeDialog}},[e._v("取消")]),s("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.updatePassword}},[e._v("确定")])],1)],1):e._e()],1)},f=[],v=a(2332),b=a(3675),P={data(){return{dialogResetPassword:!1,loading:!1,form:{newPassword:"",oldPassword:"",reconPassword:""},rules:{newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{pattern:/^(?=.*[0-9])(?=.*[a-zA-Z]).{6,12}$/,message:"必须包含数字和字母",trigger:"blur"}],reconPassword:[{required:!0,message:"请输入确认密码",trigger:"blur"},{varidate:(e,s,a)=>{s!==this.form.newPassword?a(new Error("两次输入密码不一致!")):a()},trigger:"blur"}],oldPassword:[{required:!0,message:"请输入旧密码",trigger:"blur"}]},publicKey:""}},created(){this.getRsa()},methods:{async getRsa(){const e=v.c.getRSAkey();this.publicKey=e.publicKey},show(){this.dialogResetPassword=!0},closeDialog(){this.dialogResetPassword=!1,this.$emit("close")},updatePassword(){this.$refs["formData"].validate((e=>{if(!e)return!1;{this.loading=!0;const e=(0,b.E)(this.form.oldPassword,this.publicKey),s=(0,b.E)(this.form.newPassword,this.publicKey),a=(0,b.E)(this.form.reconPassword,this.publicKey);this.$api.updateUserPassword({oldPassword:e,newPassword:s,reconPassword:a}).then((()=>{this.loading=!1,this.$alert("密码已修改,请重新登录","提示",{confirmButtonText:"确定",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1,center:!0}).then((()=>{v.c.doLogout()}))})).catch((()=>{this.loading=!1}))}}))}}},C=P,k=(0,m.c)(C,w,f,!1,null,"6f1ee0b6",null),_=k.exports,y=a(3568),D={components:{userInfo:h,ResetPassword:_},data(){return{userHeadImage:a(5976)}},computed:{isLogined(){return this.$store.state.user.access_token},userData(){const e=(0,y.cloneDeep)(this.$store.state.user.userInfo)||{};return e}},methods:{async handleSuccesAvatar(){await v.c.getUserInfoData()},doLogout(){v.c.doLogout()},goLogin(){v.c.goLogin()}}},$=D,x=(0,m.c)($,l,n,!1,null,"6ac48f2d",null),E=x.exports,R={components:{userHeaderBtn:E},props:{fullWidth:{type:Boolean,default:!1}},data(){return{}},methods:{goHome(){this.$router.push("/")}}},N=R,I=(0,m.c)(N,i,r,!1,null,"1f9ce18a",null),L=I.exports,U={components:{PageHeader:L}},A=U,H=(0,m.c)(A,t,o,!1,null,"51db6c24",null),z=H.exports},4316:function(e,s,a){e.exports=a.p+"static/img/mcd-logo.68f6a7a7.svg"},5976:function(e,s,a){e.exports=a.p+"static/img/headerImage.fe4382c2.png"}}]);
//# sourceMappingURL=444.f94a327b.js.map